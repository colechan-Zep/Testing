<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>WeChat Final Force</title>
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      /* 1. 將背景設為黑色！如果畫面變黑，代表 CSS 成功生效 */
      body, html {
        background-color: black !important;
        margin: 0;
        overflow: hidden;
      }
      
      /* 2. 測試文字：層級設為最高 (999999)，紅色 */
      #debug-text {
        position: fixed;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        color: red;
        font-size: 24px;
        font-weight: bold;
        z-index: 999999 !important;
        background: white;
        padding: 10px;
        border: 2px solid red;
      }

      /* 3. 強制 Video 顯示 */
      #arjs-video {
        z-index: 1 !important; /* 放在中間 */
      }
      
      /* 4. A-Frame 場景設為透明，放在 Video 上面 */
      .a-canvas {
        z-index: 999 !important;
        background-color: transparent !important;
      }
    </style>
  </head>
  
  <body>
    <div id="debug-text">初始化中...</div>

    <a-scene embedded 
             arjs="sourceType: webcam; debugUIEnabled: false; sourceWidth:640; sourceHeight:480; displayWidth: 640; displayHeight: 480;"
             vr-mode-ui="enabled: false"
             renderer="alpha: true; logarithmicDepthBuffer: true;">
      
      <a-marker preset="hiro">
        <a-box position="0 0.5 0" material="color: yellow; opacity: 0.8;" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // 暴力修正腳本
      var debugText = document.getElementById('debug-text');
      var checkCount = 0;

      // 每 1 秒檢查一次狀態
      setInterval(function() {
        checkCount++;
        var video = document.getElementById('arjs-video');
        
        if (video) {
          // 找到了 Video 元素
          debugText.innerHTML = "找到相機! (" + checkCount + ")";
          
          // 強制修正樣式 (防止被 WeChat 樣式覆蓋)
          video.style.display = 'block';
          video.style.position = 'absolute';
          video.style.top = '0px';
          video.style.left = '0px';
          video.style.width = '100%';
          video.style.height = '100%';
          video.style.zIndex = '-100'; // 推到底層
          video.style.objectFit = 'cover';
          
          // 觸發重繪
          window.dispatchEvent(new Event('resize'));
        } else {
          // 找不到 Video
          debugText.innerHTML = "搜尋相機中... (" + checkCount + ")";
        }
      }, 1000);
    </script>
  </body>
</html>
