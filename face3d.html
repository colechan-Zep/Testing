<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>3D Face Filter</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-face-aframe.prod.js"></script>
    
    <style>
      /* 1. è§£æ±ºç™½é‚Š + é»‘å±å•é¡Œçš„æ¨™æº–è¨­å®š */
      html, body {
        margin: 0; padding: 0; width: 100%; height: 100%;
        overflow: hidden; background-color: black !important;
      }
      
      /* 2. å¼·åˆ¶å½±ç‰‡å¡«æ»¿è¢å¹• */
      video {
        position: absolute !important;
        top: 50% !important; left: 50% !important;
        min-width: 100vw !important; min-height: 100vh !important;
        width: auto !important; height: auto !important;
        transform: translate(-50%, -50%) !important;
        z-index: 1 !important;
        object-fit: cover !important;
        display: block !important;
      }

      /* 3. AR å…§å®¹å±¤ */
      canvas.a-canvas, a-scene {
        position: absolute !important; top: 0 !important; left: 0 !important;
        width: 100% !important; height: 100% !important;
        z-index: 2 !important;
        background-color: transparent !important;
        pointer-events: none !important; /* è®“é»æ“Šç©¿é€ */
      }

      /* 4. æŒ‰éˆ•æ¨£å¼ (ç¢ºä¿ WeChat é»å¾—åˆ°) */
      .control-btn {
        position: fixed; z-index: 99999 !important;
        border-radius: 30px; border: 2px solid white; color: white;
        font-size: 16px; font-weight: bold; padding: 12px 25px;
        pointer-events: auto !important; /* å¼·åˆ¶å¯é»æ“Š */
        box-shadow: 0px 4px 10px rgba(0,0,0,0.5);
        font-family: sans-serif;
      }

      #startButton {
        bottom: 50px; left: 50%; transform: translateX(-50%);
        background: #d32f2f; /* ç´…è‰² */
      }

      #switchButton {
        top: 30px; right: 20px;
        background: #007AFF; /* è—è‰² */
        display: none; /* ä¸€é–‹å§‹éš±è— */
      }
    </style>
  </head>
  <body>

    <button id="startButton" class="control-btn">å•Ÿå‹• Face AR</button>
    <button id="switchButton" class="control-btn">ğŸ”„ è½‰é¡é ­</button>

    <a-scene mindar-face 
             embedded 
             color-space="sRGB" 
             renderer="colorManagement: true, physicallyCorrectLights, alpha: true" 
             vr-mode-ui="enabled: false" 
             device-orientation-permission-ui="enabled: false">
      
      <a-assets>
        <a-asset-item id="glassesModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.0/examples/face-tracking/assets/glasses/scene.gltf"></a-asset-item>
        <a-asset-item id="headModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.0/examples/face-tracking/assets/sparkar/headOccluder.glb"></a-asset-item>
      </a-assets>

      <a-camera active="false" position="0 0 0"></a-camera>

      <a-entity mindar-face-target="anchorIndex: 168">
        
        <a-gltf-model mindar-face-occluder position="0 -0.3 0.15" rotation="0 0 0" scale="0.065 0.065 0.065" src="#headModel"></a-gltf-model>
        
        <a-gltf-model rotation="0 0 0" position="0 0 0" scale="0.01 0.01 0.01" src="#glassesModel"></a-gltf-model>
        
      </a-entity>
    </a-scene>

    <script>
      const startBtn = document.getElementById('startButton');
      const switchBtn = document.getElementById('switchButton');
      const sceneEl = document.querySelector('a-scene');

      // 1. å•Ÿå‹• AR (WeChat å¿…é ˆè¦ç”¨æˆ¶é»æ“Šæ‰èƒ½é–‹ Video)
      startBtn.addEventListener('click', () => {
        startBtn.innerText = "è¼‰å…¥ä¸­...";
        
        // å•Ÿå‹• MindAR ç³»çµ±
        // é€™è£¡å®ƒæœƒå˜—è©¦é–‹å•Ÿå‰ç½®é¡é ­
        sceneEl.systems['mindar-face-system'].start();

        // è™•ç† UI
        setTimeout(() => {
            startBtn.style.display = 'none';   // éš±è—é–‹å§‹æ£
            switchBtn.style.display = 'block'; // é¡¯ç¤ºè½‰é¡é ­æ£
        }, 2000); // å»¶é² 2 ç§’é¡¯ç¤ºï¼Œç­‰ç›¸æ©Ÿ Ready
      });

      // 2. åˆ‡æ›é¡é ­åŠŸèƒ½
      switchBtn.addEventListener('click', () => {
        // ç°¡å–®ç›´æ¥çš„åˆ‡æ›æŒ‡ä»¤
        sceneEl.systems['mindar-face-system'].switchCamera();
      });

      // 3. ä¿®å¾©é»‘å±å•é¡Œ (ç•¶ AR æº–å‚™å¥½æ™‚ï¼Œå°‡ Body è®Šé€æ˜)
      sceneEl.addEventListener("arReady", (event) => {
        console.log("MindAR is ready");
        document.body.style.background = "transparent";
        document.documentElement.style.background = "transparent";
      });
      
      // 4. éŒ¯èª¤åµæ¸¬
      sceneEl.addEventListener("arError", (event) => {
        alert("AR éŒ¯èª¤: " + event.detail.error);
        startBtn.innerText = "é‡æ–°è¼‰å…¥";
      });
    </script>
  </body>
</html>
